(function(){var PI,abs,cos,css,getMetric,hasSupport,key,prefixList,rad,round,sin,testEl,testProp,transform,value,_ref,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};cos=Math.cos,sin=Math.sin,PI=Math.PI,abs=Math.abs,round=Math.round;rad=function(deg){return deg*PI/180};getMetric=function(style,key){return parseInt(style[key],10)};transform=function(y,angle){return"translate3d(0, "+y+"px, 0) rotate3d(0, 0, 1, "+angle+"deg)"};testProp=function(prop){var capProp,prefix,_i,_len;if(testEl.style[prop]!=null){return prop}capProp=prop.charAt(0).toUpperCase()+prop.slice(1);for(_i=0,_len=prefixList.length;_i<_len;_i++){prefix=prefixList[_i];if(testEl.style[prefix+capProp]!=null){return prefix+capProp}}return false};hasSupport=true;testEl=document.createElement("div");prefixList=["Webkit","Moz","O","ms","Khtml"];css={transform:"transform",origin:"transformOrigin",transformStyle:"transformStyle"};for(key in css){value=css[key];css[key]=testProp(value);if(!css[key]){hasSupport=false;break}}window.Maskew=function(){function Maskew(el,angle,options){var contents,eString,elStyle,eventPair,eventPairs,side,xMetrics,yMetrics,_base,_base1,_base2,_fn,_fn1,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_m,_ref,_this=this;this.el=el;this.angle=angle;this.options=options!=null?options:{};this._onTouchEnd=__bind(this._onTouchEnd,this);this._onTouchMove=__bind(this._onTouchMove,this);this._onTouchStart=__bind(this._onTouchStart,this);this.skew=__bind(this.skew,this);if(!hasSupport){return this.el}if(!(this instanceof Maskew)){return new Maskew(this.el,this.angle)}(_base=this.options).interactive||(_base.interactive=false);(_base1=this.options).anchor||(_base1.anchor="top");(_base2=this.options).showElement||(_base2.showElement=false);contents=this.el.cloneNode(true);elStyle=window.getComputedStyle(this.el);xMetrics=["width","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"];yMetrics=["height","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth"];this.width=0;for(_i=0,_len=xMetrics.length;_i<_len;_i++){key=xMetrics[_i];this.width+=getMetric(elStyle,key)}this.height=0;for(_j=0,_len1=yMetrics.length;_j<_len1;_j++){key=yMetrics[_j];this.height+=getMetric(elStyle,key)}this.outerMask=document.createElement("div");this.outerMask.style.padding="0";this.outerMask.style.width=this.width+"px";this.outerMask.style.height=this.height+"px";this.outerMask.style.overflow="hidden";if(this.options.showElement){this.el.style.display="block";this.outerMask.style.display=this.options.showElement}else{this.outerMask.style.display=elStyle.display}this.innerMask=this.outerMask.cloneNode(false);this.innerMask.style[css.origin]="bottom left";this.holder=this.outerMask.cloneNode(false);this.holder.style[css.origin]="inherit";_ref=["Top","Right","Bottom","Left"];_fn=function(key){return _this.outerMask.style[key]=elStyle[key]};for(_k=0,_len2=_ref.length;_k<_len2;_k++){side=_ref[_k];_fn("margin"+side)}this.el.style.margin="0";this.el.parentNode.insertBefore(this.outerMask,this.el);this.holder.appendChild(this.el);this.innerMask.appendChild(this.holder);this.outerMask.appendChild(this.innerMask);if(this.options.interactive){this.outerMask.style.cursor="ew-resize";eventPairs=[["TouchStart","MouseDown"],["TouchMove","MouseMove"],["TouchEnd","MouseUp"]];for(_l=0,_len3=eventPairs.length;_l<_len3;_l++){eventPair=eventPairs[_l];_fn1=function(fn){return _this.outerMask.addEventListener(eString.toLowerCase(),_this[fn],false)};for(_m=0,_len4=eventPair.length;_m<_len4;_m++){eString=eventPair[_m];_fn1("_on"+eventPair[0])}}}this.skew(this.angle)}Maskew.prototype.skew=function(angle){var adj,cosine,hyp,opp,sine,tlX,tlY,yOffset;if(angle==null){angle=this._dragAngle||0}if(angle<0){angle=0}sine=sin(rad(angle));cosine=cos(rad(angle));tlX=this.height*sine;tlY=this.height*cosine;adj=this.width-tlX;hyp=adj/cosine;opp=sine*hyp;yOffset=round(this.height-tlY+opp);this.outerMask.style.height=round(tlY-opp)+"px";this.innerMask.style.width=round(hyp)+"px";this.innerMask.style[css.transform]=transform(-yOffset,angle);this.holder.style[css.transform]=transform(0,-angle);if(this.options.anchor==="bottom"){return this.el.style[css.transform]=transform(yOffset,0)}};Maskew.prototype._onTouchStart=function(e){e.preventDefault();if(e.type==="mousedown"){this._x1=e.pageX}else if(e.type==="touchstart"){this._x1=e.touches[0].pageX}return this._xDelta=0};Maskew.prototype._onTouchMove=function(e){e.preventDefault();if(e.type==="mousemove"){if(e.which!==1){return}this._xDelta=e.pageX-this._x1}else if(e.type==="touchmove"){this._xDelta=e.touches[0].pageX-this._x1}this._dragAngle=this.angle+this._xDelta/abs(3+this._xDelta/this.width);return this.skew()};Maskew.prototype._onTouchEnd=function(e){return this.angle=this._dragAngle||this.angle};Maskew.VERSION="0.1.0";return Maskew}();if(window.jQuery!=null||((_ref=window.$)!=null?_ref.data:void 0)!=null){$.prototype.maskew=function(angle,options){var el,instance,_i,_j,_len,_len1;if(!hasSupport){return this}if(typeof angle==="object"){options=angle;angle=0}else if(angle==="skew"&&typeof options==="number"){for(_i=0,_len=this.length;_i<_len;_i++){el=this[_i];instance=$.data(el,"maskew");instance.skew.call(instance,options)}return this}for(_j=0,_len1=this.length;_j<_len1;_j++){el=this[_j];if(instance=$.data(el,"maskew")){return instance}$.data(el,"maskew",new Maskew(el,angle,options))}return this}}}).call(this);